<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

<script>
window.mobile = 'standalone' in navigator;
document.addEventListener('DOMContentLoaded', function (){
	if(mobile) window['touch-ctrl'].style.display = 'block';
	eleKeySim(window['touch-left-ctrl'], 37);
	eleKeySim(window['touch-right-ctrl'], 39);
	eleKeySim(window['touch-up-ctrl'], 38);
});
</script>
<script src="./js/touch.js"></script>

<script src="./js/util.js"></script>

<!-- constructors -->
<script src="./js/events.js"></script>
<script src="./js/cbject.js"></script>
<script src="./js/actor.js"></script>
<script src="./js/player.js"></script>

<!-- game -->
<script src="./js/game.js"></script>
<script src="./js/sprites.js"></script>
<script src="./js/items.js"></script>
<script data-src="./js/usernote.js">
var user = {};
user.notify = function (){
	var args = Array.prototype.slice.call(arguments);
	console.log('user.notify:: '+ args.join(' '));
};
user.warn = function (){
	var args = Array.prototype.slice.call(arguments);
	console.log('user.warn:: '+ args.join(' '));
};
</script>

<style>
body {overflow:hidden;}
canvas {position:absolute;left:0;top:0;}
#touch-ctrl {position:absolute;bottom:0;left:0;right:0;padding:10px}
#touch-ctrl .ctrl {
float:left;margin:0 10px;width:40px;height:40px;
background-image:url(./assets/interface/ctrl-move.png);background-size:auto 80px;}
#touch-ctrl .ctrl:active {background-position-y:40px;}
#touch-left-ctrl.ctrl {width:50px;background-position-x:0px;margin-right:0;}
#touch-right-ctrl.ctrl {width:50px;background-position-x:90px;margin-left:0;}
#touch-up-ctrl.ctrl {background-position-x:180px;}
</style>

<canvas id="can"></canvas>

<div id="touch-ctrl" style="display:none;">
	<div class="ctrl" id="touch-left-ctrl"></div>
	<div class="ctrl" id="touch-right-ctrl"></div>
	
	<div class="ctrl" id="touch-up-ctrl" style="float:right;"></div>
</div>

<style>
#inventory_button {
display:block;
position:absolute;
top:10px;
right:10px;
width:30px;
height:30px;
background:rgba(0,0,0,0.1);
z-index:1001;
}
#inventory_button:active {
background:rgba(0,0,0,0.2);
}
#items {
display: none;
position: absolute;
top: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.2);
min-width: 200px;
max-width: 90%;
padding: 10px;
font-family: monospace;
cursor: default;
z-index: 1000;
}
#items.show {
display: block;
}
#items:before {
display: block;
content: "Inventory";
text-align:center;
font-size:18px;
color:#ffffff;
margin-bottom:10px;
padding:4px;
}
#items .item {
padding:4px 8px;
border-left:2px solid transparent;
box-shadow:inset 0 -1px 0 rgba(255,255,255,0.2);
margin-bottom:2px;
}
#items .item:active {
background:rgba(255,255,255,0.1);
}
#items .item[data-equipped] {
border-left-color:#ffffff;
}
</style>
<div id="inventory_button"></div>
<div id="items"></div>

<script>
w.on('load', function (){
// temporary stuff for testing

var inv_button = document.getElementById('inventory_button'),
	items = document.getElementById('items');

inv_button.addEventListener('click', function (){
	if(items.classList.contains('show')){
		items.classList.remove('show');
		g.emit('start');
	}else{
		items.classList.add('show');
		items.innerHTML = '';
		listItems();
		g.emit('stop');
	}
});

function listItems (){
	var i, te, pl = g.player;
	
	for(i in pl.items){
		te = items.appendChild(document.createElement('div'));
		te.className = 'item';
		te.innerText = pl.items[i].it.name;
		te.setAttribute('data-itemid', i);
		if(pl.isEquipped(i)){
			te.setAttribute('data-equipped', '');
		}
		te.addEventListener('click', (function (itemId){
			return function (ev){
				var el = this;
				if(pl.isEquipped(itemId)){
					pl.unequipItem(itemId);
					el.removeAttribute('data-equipped');
				}else{
					pl.equipItem(itemId);
					el.setAttribute('data-equipped', '');
				}
				g.emit('draw');
			}
		}(i)) );
	}
}

g.player.addItem('001');
g.player.addItem('002');
g.player.addItem('003');
g.player.addItem('004');
g.player.addItem('005');

});
</script>